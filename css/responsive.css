/* ===========================================
   RESPONSIVE BREAKPOINTS
   Desktop > 1200px (default styles)
   Tablet Landscape: 901-1200px
   Tablet Portrait / iPad: 768-900px
   Mobile Large: 481-767px
   Mobile Small: ≤480px
   =========================================== */

/* Tablet Landscape (901-1200px) */
@media (max-width: 1200px) and (min-width: 901px) {
  .content-area {
    width: clamp(300px, 32vw, 360px);
  }
  .avatar-area {
    width: clamp(180px, 32vw, 380px);
    left: 2%;
  }
  .logo-tagline { display: none; }
}

/* Tablet Portrait / iPad (768-900px) */
@media (max-width: 900px) and (min-width: 768px) {
  .content-area {
    position: absolute;
    right: 0;
    top: 0;
    width: clamp(280px, 45vw, 380px);
    padding: 12px;
    padding-bottom: 160px; /* Space for dialogue */
    overflow-y: auto;
    height: calc(100% - 48px);
  }
  /* Avatar only shows in FULL mode on tablet */
  .avatar-area {
    width: clamp(180px, 30vw, 280px);
    height: clamp(320px, 55vh, 480px);
    left: 2%;
    bottom: calc(clamp(16px, 3vh, 24px) + var(--dialogue-height-tablet) + var(--avatar-dialogue-gap));
    z-index: var(--z-avatar);
  }
  .avatar-img {
    image-rendering: auto;
    -webkit-backface-visibility: hidden;
  }
  .avatar-area.mode-full {
    opacity: 1;
  }
  /* Head mode - positioned at bottom-left, next to dialogue */
  .avatar-area.mode-head {
    opacity: 1;
    visibility: visible;
    width: clamp(70px, 10vw, 100px);
    height: clamp(90px, 14vh, 120px);
    left: 2%;
    bottom: clamp(16px, 3vh, 24px); /* Same bottom as dialogue */
    overflow: hidden;
  }
  .avatar-area.mode-head .avatar-img {
    width: 100%;
    height: auto;
    max-width: 100%;
    object-fit: cover;
    object-position: top center;
  }
  /* Off mode - avatar visible, dialogue hidden */
  .avatar-area.mode-off {
    opacity: 1;
    visibility: visible;
  }
  /* Main screen dialogue - centered at bottom */
  .dialogue-container {
    width: clamp(400px, 70vw, 600px);
    left: 50%;
    transform: translateX(-50%);
    height: clamp(100px, 16vh, 140px);
    bottom: clamp(16px, 3vh, 24px);
  }
  /* Title/Selection screen dialogue - centered on screen */
  #title-scene .dialogue-container,
  #selection-scene .dialogue-container {
    bottom: auto;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    width: clamp(350px, 80vw, 550px);
    height: clamp(110px, 18vh, 150px);
  }
  /* Portrait - integrated with dialogue box left edge */
  .dialogue-portrait {
    width: clamp(80px, 12vw, 110px);
    height: clamp(80px, 12vw, 110px);
    left: 0;
    top: 50%;
    transform: translate(-50%, -50%);
  }
  .dialogue-portrait img {
    image-rendering: auto;
    -webkit-backface-visibility: hidden;
  }
  .header {
    padding: 0 12px;
    gap: 8px;
  }
  .header-left { gap: 12px; }
  .header-right { gap: 12px; }
  .header-stats { display: none; }
  .logo-tagline { display: none; }
  .nav-btn { padding: 8px 12px; font-size: 11px; }
  .wallet-btn { padding: 8px 14px; font-size: 11px; }
  .dialogue-controls { opacity: 1; gap: 4px; }
  .dialogue-ctrl-btn { width: 24px; height: 24px; }
  .dialogue-ctrl-btn svg { width: 12px; height: 12px; }
  .avatar-mode-btn { width: 24px; height: 24px; }
  .avatar-mode-btn svg { width: 14px; height: 14px; }
  .dialogue-ctrl-divider { height: 16px; margin: 0 2px; }
}

/* Mobile Large (481-767px) */
@media (max-width: 767px) and (min-width: 481px) {
  /* Content scrolls - centered with padding at bottom for avatar + dialogue */
  .content-area {
    position: absolute;
    top: 0;
    left: 50%;
    transform: translateX(-50%);
    bottom: 0;
    width: 90%;
    max-width: 500px;
    padding: 10px;
    padding-bottom: 120px; /* Space for dialogue + avatar height */
    overflow-y: auto;
    overflow-x: hidden;
    -webkit-overflow-scrolling: touch;
  }
  /* FULL mode: Avatar at bottom-left, aligned with dialogue box */
  .avatar-area {
    position: fixed;
    width: clamp(100px, 22vw, 140px);
    height: clamp(220px, 45vh, 320px);
    left: 0;
    bottom: 10px; /* Aligned with dialogue bottom */
    z-index: var(--z-avatar-mobile);
    background: none;
    border: none;
    border-radius: 0;
  }
  .avatar-area.mode-full {
    opacity: 1;
    visibility: visible;
  }
  /* HEAD mode: Same position, smaller, shows head only */
  .avatar-area.mode-head {
    opacity: 1;
    visibility: visible;
    width: clamp(60px, 14vw, 85px);
    height: clamp(80px, 18vw, 110px);
    left: 0;
    bottom: 10px;
    overflow: hidden;
  }
  .avatar-area.mode-head .avatar-img {
    width: 100%;
    height: auto;
    max-width: 100%;
    object-fit: cover;
    object-position: top center;
  }
  /* OFF mode: avatar visible, dialogue hidden */
  .avatar-area.mode-off {
    opacity: 1;
    visibility: visible;
  }
  .avatar-img {
    image-rendering: auto;
    -webkit-backface-visibility: hidden;
    filter: drop-shadow(0 0 15px rgba(80, 160, 220, 0.3));
  }
  /* Dialogue at bottom-right, leaving space for avatar */
  .dialogue-container {
    position: fixed;
    width: calc(100% - 100px); /* Room for avatar on left */
    left: auto;
    right: 8px;
    transform: none;
    height: clamp(50px, 8vh, 65px);
    bottom: 10px;
    z-index: var(--z-dialogue);
  }
  /* Portrait ALWAYS hidden on mobile - avatar-area handles it */
  .dialogue-portrait,
  .dialogue-container .dialogue-portrait.visible {
    display: none;
    opacity: 0;
    visibility: hidden;
    pointer-events: none;
  }
  .dialogue-box {
    padding: 8px 12px 8px 14px;
  }
  .dialogue-text { font-size: clamp(10px, 2.5vw, 12px); min-height: 20px; line-height: 1.3; }
  .dialogue-name { font-size: 9px; margin-bottom: 3px; }
  /* Header - cleaner mobile layout */
  .header {
    display: grid;
    grid-template-columns: 1fr auto;
    grid-template-rows: auto auto;
    padding: 8px 12px;
    gap: 8px;
    height: auto;
    min-height: 44px;
  }
  .header-left {
    grid-column: 1;
    grid-row: 1;
    display: flex;
    align-items: center;
    gap: 8px;
  }
  .header-right {
    grid-column: 2;
    grid-row: 1;
    display: flex;
    align-items: center;
  }
  .logo { display: flex; align-items: center; gap: 6px; }
  .logo-text { font-size: 14px; letter-spacing: 2px; }
  .logo-tagline { display: none; }
  .header-stats { display: none; }
  .wallet-btn {
    padding: 6px 10px;
    font-size: 10px;
    white-space: nowrap;
  }
  .nav {
    grid-column: 1 / -1;
    grid-row: 2;
    display: flex;
    justify-content: stretch;
    gap: 4px;
  }
  .nav-btn {
    flex: 1;
    padding: 8px 4px;
    font-size: 10px;
    text-align: center;
    justify-content: center;
    white-space: nowrap;
  }
  .dialogue-controls {
    opacity: 1;
    gap: 2px;
    top: 3px;
    right: 6px;
    flex-wrap: nowrap;
    justify-content: flex-end;
  }
  .dialogue-ctrl-btn { min-width: 20px; min-height: 20px; width: 20px; height: 20px; }
  .dialogue-ctrl-btn svg { width: 10px; height: 10px; }
  .avatar-mode-btn { min-width: 20px; min-height: 20px; width: 20px; height: 20px; }
  .avatar-mode-btn svg { width: 10px; height: 10px; }
  .avatar-mode-btn.off-btn svg { width: 8px; height: 8px; }
  .dialogue-ctrl-divider { display: none; }
  .title-logo { font-size: clamp(32px, 9vw, 48px); letter-spacing: clamp(4px, 1.5vw, 8px); }
  .title-tagline { font-size: clamp(11px, 2.8vw, 14px); }
  .panels-container { padding: 0 10px; width: 100%; }
  .full-page { padding: 10px; }
  .portfolio-stats { grid-template-columns: repeat(2, 1fr); }
}

/* Mobile Small (≤480px) - iPhone dimensions */
@media (max-width: 480px) {
  /* Content scrolls - centered with padding at bottom for avatar + dialogue */
  .content-area {
    position: absolute;
    top: 0;
    left: 50%;
    transform: translateX(-50%);
    bottom: 0;
    width: 92%;
    max-width: 400px;
    padding: 8px;
    padding-bottom: 100px; /* Space for avatar + dialogue */
    overflow-y: auto;
    overflow-x: hidden;
    -webkit-overflow-scrolling: touch;
  }
  /* FULL mode: Avatar at bottom-left, aligned with dialogue */
  .avatar-area {
    position: fixed;
    width: clamp(85px, 20vw, 120px);
    height: clamp(180px, 40vh, 280px);
    left: 0;
    bottom: 8px; /* Aligned with dialogue bottom */
    z-index: var(--z-avatar-mobile);
    background: none;
    border: none;
    border-radius: 0;
  }
  .avatar-area.mode-full {
    opacity: 1;
    visibility: visible;
  }
  /* HEAD mode: Same position, smaller, shows head only */
  .avatar-area.mode-head {
    opacity: 1;
    visibility: visible;
    width: clamp(55px, 14vw, 75px);
    height: clamp(70px, 17vw, 100px);
    left: 0;
    bottom: 8px;
    overflow: hidden;
  }
  .avatar-area.mode-head .avatar-img {
    width: 100%;
    height: auto;
    max-width: 100%;
    object-fit: cover;
    object-position: top center;
  }
  /* OFF mode: avatar visible, dialogue hidden */
  .avatar-area.mode-off {
    opacity: 1;
    visibility: visible;
  }
  .avatar-img {
    image-rendering: auto;
    -webkit-backface-visibility: hidden;
    filter: drop-shadow(0 0 12px rgba(80, 160, 220, 0.25));
  }
  .main-interface { padding: 0; }
  /* Header - clean grid layout */
  .header {
    display: grid;
    grid-template-columns: 1fr auto;
    grid-template-rows: auto auto;
    padding: 6px 10px;
    gap: 6px;
    height: auto;
    min-height: 40px;
  }
  .header-left {
    grid-column: 1;
    grid-row: 1;
    display: flex;
    align-items: center;
    gap: 6px;
  }
  .header-right {
    grid-column: 2;
    grid-row: 1;
    display: flex;
    align-items: center;
  }
  .logo { display: flex; align-items: center; gap: 6px; }
  .logo-text { font-size: 12px; letter-spacing: 1.5px; }
  .logo-mark { width: 22px; height: 22px; }
  .logo-tagline { display: none; }
  .header-stats { display: none; }
  .wallet-btn {
    padding: 5px 8px;
    font-size: 9px;
    white-space: nowrap;
  }
  .nav {
    grid-column: 1 / -1;
    grid-row: 2;
    display: flex;
    justify-content: stretch;
    gap: 3px;
  }
  .nav-btn {
    flex: 1;
    padding: 8px 2px;
    font-size: 9px;
    text-align: center;
    justify-content: center;
    white-space: nowrap;
  }
  /* Dialogue fixed at bottom - shifted right for head */
  .dialogue-container {
    position: fixed;
    width: calc(94% - 60px); /* Room for head on left */
    left: auto;
    right: 3%;
    transform: none;
    height: clamp(45px, 7vh, 55px);
    bottom: 8px;
    z-index: var(--z-dialogue);
  }
  /* Portrait ALWAYS hidden on mobile - avatar-area handles it */
  .dialogue-portrait,
  .dialogue-container .dialogue-portrait.visible {
    display: none;
    opacity: 0;
    visibility: hidden;
    pointer-events: none;
  }
  .dialogue-box {
    padding: 6px 10px 6px 12px;
  }
  .dialogue-text { font-size: clamp(9px, 2.5vw, 11px); min-height: 16px; line-height: 1.25; }
  .dialogue-name { font-size: 8px; margin-bottom: 2px; }
  /* Dialogue controls - ultra compact for small dialogue */
  .dialogue-controls {
    opacity: 1;
    top: 1px;
    right: 2px;
    gap: 1px;
    flex-wrap: nowrap;
    justify-content: flex-end;
  }
  .dialogue-ctrl-btn { min-width: 12px; min-height: 12px; width: 12px; height: 12px; padding: 1px; }
  .dialogue-ctrl-btn svg { width: 6px; height: 6px; }
  .avatar-mode-btn { min-width: 12px; min-height: 12px; width: 12px; height: 12px; padding: 1px; }
  .avatar-mode-btn svg { width: 6px; height: 6px; }
  .avatar-mode-btn.off-btn svg { width: 5px; height: 5px; }
  .dialogue-ctrl-divider { display: none; }
  .dialogue-continue { bottom: 2px; right: 4px; font-size: 6px; }
  .panel { border-radius: 8px; }
  .panel-head { padding: 10px 12px; }
  .panel-body { padding: 10px; }
  .order-tabs { grid-template-columns: repeat(2, 1fr); gap: 6px; }
  .order-tab { padding: 10px 6px; font-size: 10px; }
  .form-input { padding: 12px; font-size: 16px; }
  .order-btn { padding: 14px; font-size: 12px; }
  .pos-tabs { flex-wrap: wrap; gap: 6px; }
  .pos-tab { padding: 8px 12px; font-size: 10px; }
  .title-logo { font-size: clamp(28px, 10vw, 42px); letter-spacing: clamp(4px, 1.5vw, 8px); }
  .title-tagline { font-size: clamp(10px, 3vw, 13px); }
  .title-start { font-size: 11px; }
  .enter-btn { font-size: clamp(14px, 4vw, 18px); padding: 16px 32px; }
  .selection-buttons { flex-direction: column; gap: 14px; }
  .selection-btn { padding: 18px 28px; min-width: 200px; }
  .selection-message { font-size: 15px; padding: 0 20px; text-align: center; }
  .selection-question { font-size: 13px; }
  .panels-container { padding: 0 8px; width: 100%; }
  .full-page { padding: 10px 8px; }
  .portfolio-stats { grid-template-columns: 1fr; gap: 10px; }
  .portfolio-stat-value { font-size: 18px; }
  .lb-item { grid-template-columns: 28px 1fr; gap: 8px; padding: 12px; }
  .lb-pnl { grid-column: 2; font-size: 12px; }
  .feed-item { padding: 12px; }
  .connection-indicator { bottom: 8px; left: 8px; padding: 4px 8px; font-size: 10px; }
  .diagnostic-panel { width: calc(100% - 16px); left: 8px; bottom: 45px; }
}

/* Mobile title/selection screens */
@media (max-width: 767px) {
  /* Title screen - content at top, dialogue below */
  .title-screen {
    padding-top: 10vh;
  }
  /* Title screen dialogue - positioned in middle-lower area */
  #title-scene .dialogue-container,
  #selection-scene .dialogue-container {
    position: absolute;
    bottom: auto;
    top: 50%;
    left: 50%;
    transform: translate(-50%, 0);
    width: 90%;
    height: clamp(100px, 16vh, 130px);
  }
  #title-scene .dialogue-portrait,
  #title-scene .dialogue-portrait.visible,
  #selection-scene .dialogue-portrait,
  #selection-scene .dialogue-portrait.visible {
    display: none;
    opacity: 0;
  }
  #title-scene .dialogue-box,
  #selection-scene .dialogue-box {
    padding: 16px 20px;
  }
}

/* Touch device enhancements - only for larger screens */
@media (hover: none) and (pointer: coarse) and (min-width: 481px) {
  .dialogue-controls { opacity: 1; }
  .dialogue-ctrl-btn {
    min-width: 24px;
    min-height: 24px;
  }
  .avatar-mode-btn {
    min-width: 24px;
    min-height: 24px;
  }
  .nav-btn, .wallet-btn, .order-tab, .pos-close {
    min-height: 40px;
  }
}

/* Landscape orientation on mobile */
@media (max-height: 500px) and (orientation: landscape) {
  .content-area {
    padding-bottom: 100px;
  }
  .avatar-area {
    position: fixed;
    height: clamp(80px, calc(100vh - 80px), 150px);
    width: clamp(50px, 10vw, 90px);
    bottom: 70px;
    opacity: 1;
  }
  /* Head mode - positioned left of dialogue */
  .avatar-area.mode-head {
    opacity: 1;
    visibility: visible;
    width: clamp(50px, 10vw, 70px);
    height: clamp(60px, 14vh, 80px);
    left: 0;
    bottom: 5px;
    overflow: hidden;
  }
  .avatar-area.mode-head .avatar-img {
    width: 100%;
    height: auto;
    max-width: 100%;
    object-fit: cover;
    object-position: top center;
  }
  .avatar-img {
    image-rendering: auto;
  }
  .dialogue-container {
    position: fixed;
    width: calc(90% - 55px); /* Room for head */
    left: auto;
    right: 5%;
    height: clamp(60px, 14vh, 80px);
    bottom: 5px;
  }
  .dialogue-box { padding: 8px 14px; }
  .dialogue-text { font-size: 12px; min-height: 24px; line-height: 1.3; }
  .dialogue-name { margin-bottom: 3px; font-size: 10px; }
  .dialogue-portrait,
  .dialogue-container .dialogue-portrait.visible {
    display: none;
    opacity: 0;
  }
  .title-content { top: 25%; }
  .title-logo { font-size: clamp(20px, 5vh, 32px); }
  .header { height: auto; min-height: 36px; }
}

/* Large screens (1200px+) */
@media (min-width: 1201px) {
  .dialogue-container {
    width: clamp(450px, 45vw, 650px);
  }
  .avatar-area {
    width: clamp(300px, 38vw, 550px);
  }
  /* Hide avatar-area in head mode - dialogue-portrait handles it */
  .avatar-area.mode-head {
    opacity: 0;
    visibility: hidden;
    pointer-events: none;
  }
}

/* Very large screens (1600px+) */
@media (min-width: 1600px) {
  .content-area {
    width: clamp(380px, 25vw, 450px);
  }
  .dialogue-container {
    width: clamp(500px, 40vw, 700px);
    height: clamp(130px, 15vh, 170px);
  }
  .avatar-area {
    width: clamp(400px, 35vw, 600px);
  }
}
